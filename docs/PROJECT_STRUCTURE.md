# Структура проекта Star_Void

## Обзор
Star_Void - терминальный софт на Python для паузы и рефлексии. Программа предоставляет минималистичное пространство для взаимодействия с ИИ, который не советует, не утешает и допускает молчание.

---

## Корневая директория `/`

### `mailn.py`
**Назначение:** Главная точка входа в приложение.

**Что делает:**
- Запускает основной цикл программы
- Выводит приветственное сообщение
- Принимает пользовательский ввод через `input(">")`
- Вызывает функцию `respond()` для обработки ввода
- Обрабатывает KeyboardInterrupt для корректного выхода

**Как работает:**
1. Выводит описание программы
2. Входит в бесконечный цикл `while True`
3. Ожидает ввод пользователя
4. Пропускает пустые строки
5. Передает ввод в систему ответа
6. Выводит ответ (если есть)
7. При Ctrl+C выходит с сообщением "Goodbye!"

**Статус:** Требует доработки (функция `respond()` не импортирована)

---

### `pyproject.toml`
**Назначение:** Конфигурация Python-проекта (PEP 517/518).

**Что содержит:**
- Метаданные проекта (имя, версия, автор)
- Системные требования для сборки
- Зависимости проекта
- Настройки инструментов разработки (black, pytest, flake8)
- Указание на структуру пакетов в `src/`

**Как использовать:**
```bash
pip install -e .  # Установка в режиме разработки
pip install .     # Установка проекта
```

---

### `requirements.txt`
**Назначение:** Список зависимостей для pip.

**Текущие зависимости:**
- `rich==14.2.0` - библиотека для красивого форматирования терминального вывода

**Как использовать:**
```bash
pip install -r requirements.txt
```

---

### `README.md`
**Назначение:** Документация проекта на русском языке.

**Содержит:**
- Описание концепции Star_Void
- Цели проекта
- Характеристики поведения ИИ
- Информацию об авторах

---

### `.gitignore`
**Назначение:** Указывает Git, какие файлы не нужно отслеживать.

**Должен содержать:**
- `__pycache__/`
- `*.pyc`
- `.env`
- `venv/`, `.venv/`
- `.DS_Store`
- `*.log`

---

### `txt.md`
**Назначение:** Неясно (требует проверки содержимого).

**Рекомендация:** Переименовать или удалить, если не используется.

---

## Директория `/src/`

Основная директория с исходным кодом проекта.

---

## Директория `/src/ai/`

Ядро системы генерации ответов ИИ.

### `responder.py`
**Назначение:** Единая точка общения с ИИ.

**Что должен делать:**
- Принимать пользовательский ввод
- Определять режим ответа (ask, distort, void, silence)
- Интегрироваться с API внешнего LLM (например, OpenAI, Anthropic)
- Применять промпты из `/src/config/ai/`
- Вызывать фильтры из `filters.py`
- Применять логику молчания из `silence.py`
- Возвращать финальный ответ или `None` (для молчания)

**Как должен работать:**
```python
def respond(user_input: str, mode: str = "ask") -> Optional[str]:
    # 1. Выбрать промпт из config/ai/ в зависимости от режима
    # 2. Добавить пользовательский ввод
    # 3. Вызвать LLM API
    # 4. Применить фильтры (длина, советы, эмпатия)
    # 5. Решить, нужно ли молчание
    # 6. Вернуть ответ или None
```

**Текущий статус:** Пустой файл (только комментарий)

---

### `filters.py`
**Назначение:** Пост-обработка ответов ИИ для соответствия философии проекта.

**Что делает:**
- `filter_length(text, max_length)` - обрезает текст до максимальной длины
- `filter_advice(text)` - удаляет фразы-советы ("попробуй", "рекомендую", "нужно")
- `filter_empathy(text)` - удаляет эмпатичные фразы ("понимаю", "сочувствую", "не переживай")

**Как работает:**
1. Получает сырой текст от LLM
2. Проходит по списку нежелательных маркеров
3. Удаляет строки или фразы, содержащие эти маркеры
4. Очищает двойные пробелы и лишние переводы строк
5. Возвращает отфильтрованный текст

**Применение:**
```python
raw_response = llm_api_call(prompt)
filtered = filter_advice(raw_response)
filtered = filter_empathy(filtered)
filtered = filter_length(filtered, max_length=150)
```

**Текущий статус:** Полностью реализован

---

### `silence.py`
**Назначение:** Логика намеренного молчания.

**Что должен делать:**
- Решать, когда ИИ должен промолчать вместо ответа
- Использовать случайность (например, 20% вероятность молчания)
- Анализировать контекст (короткие входы, повторы, определённые фразы)
- Учитывать режим работы (в `void` молчание чаще)

**Как должен работать:**
```python
def should_be_silent(user_input: str, mode: str = "ask") -> bool:
    # 1. Базовая вероятность молчания
    # 2. Увеличение вероятности для коротких/пустых входов
    # 3. Увеличение вероятности в режиме void
    # 4. Детекция входов, требующих молчания
    # 5. Возврат True/False
```

**Примеры ситуаций для молчания:**
- Пользователь ввел "..."
- Очень короткий ввод (1-2 слова)
- Повторяющиеся сообщения
- Случайный выбор (рандомизация)

**Текущий статус:** Пустой файл (только комментарий)

---

## Директория `/src/modules/`

Различные режимы работы программы.

### `ask.py`
**Назначение:** Режим диалога - базовый режим взаимодействия.

**Что должен делать:**
- Принимать вопрос/высказывание пользователя
- Использовать промпт `config/ai/ask.txt` + `core.txt`
- Генерировать краткий, дистанцированный ответ
- Может задать вопрос для углубления, но не для решения
- Не даёт советов, не утешает

**Как должен работать:**
```python
def ask(user_input: str) -> Optional[str]:
    # 1. Загрузить промпт ask.txt
    # 2. Вызвать responder.respond(user_input, mode="ask")
    # 3. Вернуть результат
```

**Пример взаимодействия:**
```
> Я не знаю, что делать дальше
< А что значит "дальше"?
```

**Текущий статус:** Заглушка (только print)

---

### `distort.py`
**Назначение:** Режим искажения - растворение смысла.

**Что должен делать:**
- Принимать высказывание пользователя
- Использовать промпт `config/ai/distort.txt`
- Разрушать структуру входа
- Возвращать фрагменты, абстракции, отсутствие

**Методы искажения:**
- Извлечение одного слова
- Фрагментация предложения
- Замена многоточием
- Полное удаление (молчание)
- Абстрагирование

**Как должен работать:**
```python
def distort(user_input: str) -> Optional[str]:
    # 1. Загрузить промпт distort.txt
    # 2. Вызвать responder с режимом "distort"
    # 3. Дополнительно обработать через utils/text.py
    # 4. Вернуть фрагмент или None
```

**Пример взаимодействия:**
```
> Сегодня был тяжелый день, я устал
< тяжелый
```

или

```
> Я чувствую себя потерянным
< ...
```

**Текущий статус:** Заглушка (только print)

---

### `void.py`
**Назначение:** Пассивный режим - фоновое присутствие.

**Что должен делать:**
- Работать в фоне без активного запроса
- Периодически генерировать собственные высказывания
- Использовать промпт `config/ai/void.txt`
- Не реагировать на пользовательский ввод напрямую
- Молчать большую часть времени

**Как должен работать:**
```python
def void() -> Optional[str]:
    # 1. Решить, говорить ли (низкая вероятность, ~5%)
    # 2. Если говорить - загрузить промпт void.txt
    # 3. Генерировать абстрактное наблюдение
    # 4. Вернуть фразу или None
```

**Пример выхода:**
```
< Тишина тоже что-то значит.
```

или просто молчание на протяжении минут.

**Интеграция:** Может запускаться как фоновый поток с большими задержками.

**Текущий статус:** Заглушка (только print)

---

### `silence.py`
**Назначение:** Режим молчания - явный отказ от ответа.

**Что должен делать:**
- Возвращать `None` или пустую строку
- Может использоваться как явный режим
- Отличается от `silence.py` в `/src/ai/` тем, что это именно **режим**, а не логика

**Как должен работать:**
```python
def silence() -> None:
    # Явно ничего не возвращает
    return None
```

**Применение:**
- Когда пользователь выбирает режим "молчание"
- Как ответ на определенные команды

**Текущий статус:** Заглушка (только print)

---

## Директория `/src/utils/`

Вспомогательные утилиты общего назначения.

### `randomness.py`
**Назначение:** Утилиты для рандомизации промптов.

**Что делает:**
- `list_prompt_files()` - список всех .txt файлов в config/ai/
- `read_prompt_file(path, **kwargs)` - чтение промпта с подстановкой переменных
- `random_prompt_file()` - выбор случайного файла-промпта
- `random_prompt(name, **kwargs)` - получение промпта по имени или случайного
- `random_prompt_block(name, **kwargs)` - выбор случайного блока из промпта (разделенного `---`)
- `safe_format(text, **kwargs)` - безопасное форматирование строк

**Как работает:**
1. Определяет путь к директории `src/config/ai/`
2. Читает .txt файлы
3. Поддерживает разделение на блоки через `---` или `\n\n`
4. Выбирает случайный вариант
5. Подставляет переменные через `.format()`

**Применение:**
```python
from src.utils.randomness import random_prompt

prompt = random_prompt("ask", user_input="Привет")
# Вернет содержимое ask.txt с подстановкой {user_input}
```

**Текущий статус:** Полностью реализован

---

### `delay.py`
**Назначение:** Управление паузами и медленностью ответа.

**Что должен делать:**
- Создавать намеренные задержки перед ответом
- Имитировать "думающего" ИИ
- Усиливать атмосферу рефлексии

**Как должен работать:**
```python
import time
import random

def random_delay(min_sec: float = 0.5, max_sec: float = 2.0):
    """Случайная пауза между min и max секундами."""
    time.sleep(random.uniform(min_sec, max_sec))

def typing_effect(text: str, chars_per_second: int = 30):
    """Вывод текста посимвольно с эффектом печати."""
    for char in text:
        print(char, end='', flush=True)
        time.sleep(1 / chars_per_second)
    print()

def weighted_delay(user_input: str):
    """Задержка зависит от длины ввода."""
    base_delay = 0.5
    input_length_factor = len(user_input) * 0.01
    delay = min(base_delay + input_length_factor, 3.0)
    time.sleep(delay)
```

**Применение:**
```python
user_input = input("> ")
weighted_delay(user_input)
response = respond(user_input)
typing_effect(response)
```

**Текущий статус:** Пустой файл (только комментарий)

---

### `text.py`
**Назначение:** Обрезка и фрагментация текста.

**Что должен делать:**
- Разбивать текст на фрагменты
- Извлекать случайные части
- Обрезать предложения на середине
- Создавать эффект неполноты

**Как должен работать:**
```python
def fragment_sentence(text: str) -> str:
    """Обрезает предложение на случайном месте."""
    if len(text) < 10:
        return text
    cut_point = random.randint(5, len(text) - 2)
    return text[:cut_point] + "..."

def extract_random_word(text: str) -> str:
    """Извлекает случайное слово из текста."""
    words = text.split()
    return random.choice(words) if words else ""

def reduce_text(text: str, reduction_level: float = 0.5) -> str:
    """Удаляет случайные слова из текста.
    
    reduction_level: 0.0 (ничего не удалять) до 1.0 (удалить все)
    """
    words = text.split()
    keep_count = int(len(words) * (1 - reduction_level))
    kept_words = random.sample(words, keep_count)
    return " ".join(kept_words)

def truncate_mid_sentence(text: str) -> str:
    """Обрезает текст на середине предложения."""
    sentences = text.split(". ")
    if len(sentences) > 1:
        return sentences[0][:len(sentences[0])//2] + "..."
    return fragment_sentence(text)
```

**Применение:**
```python
# В режиме distort
response = llm_call(user_input)
distorted = fragment_sentence(response)
# или
distorted = extract_random_word(response)
```

**Текущий статус:** Пустой файл (только комментарий)

---

## Директория `/src/config/`

Конфигурационные файлы.

### `config.env`
**Назначение:** Переменные окружения и настройки.

**Что должен содержать:**
```env
# API ключи
OPENAI_API_KEY=your_key_here
ANTHROPIC_API_KEY=your_key_here

# Настройки LLM
LLM_PROVIDER=openai  # openai, anthropic, local
MODEL_NAME=gpt-4
MAX_TOKENS=150
TEMPERATURE=0.7

# Вероятности поведения
SILENCE_PROBABILITY=0.2
VOID_SPEAK_PROBABILITY=0.05

# Фильтры
MAX_RESPONSE_LENGTH=200
ENABLE_ADVICE_FILTER=true
ENABLE_EMPATHY_FILTER=true

# Задержки
MIN_DELAY_SEC=0.5
MAX_DELAY_SEC=2.0
TYPING_SPEED_CPS=30
```

**Загрузка:**
```python
from dotenv import load_dotenv
import os

load_dotenv("src/config/config.env")
api_key = os.getenv("OPENAI_API_KEY")
```

**Текущий статус:** Существует, но содержимое неизвестно

---

## Директория `/src/config/ai/`

Промпты для управления поведением ИИ.

### `core.txt`
**Назначение:** Базовый системный промпт - философия Star_Void.

**Содержит:**
- Определение сущности ИИ (не ассистент, не терапевт)
- Правила краткости (1-2 предложения максимум)
- Запреты: советы, утешения, эмпатия, списки
- Тон: спокойный, дистанцированный, нейтральный
- Разрешение на молчание, уклончивость, фрагментарность

**Применение:** Добавляется ко всем запросам как базовая инструкция.

---

### `ask.txt`
**Назначение:** Дополнительный промпт для режима диалога.

**Содержит:**
- Инструкции для ответа на вопросы
- Разрешение на рефрейминг и зеркалирование мыслей
- Запрет на решение проблем
- Возможность задать один вопрос (но не для направления)

**Применение:** Объединяется с `core.txt` при вызове режима `ask`.

---

### `distort.txt`
**Назначение:** Промпт для режима искажения.

**Содержит:**
- Инструкции по растворению входа
- Методы: фрагментация, абстракция, удаление смысла
- Запрет на сохранение структуры и намерения
- Предпочтение: пробелы, многоточия, негация, редукция

**Применение:** Используется для режима `distort`.

---

### `void.txt`
**Назначение:** Промпт для пассивного режима.

**Содержит:**
- Инструкции для спонтанных высказываний
- Разрешение на долгое молчание
- Избегание прямого обращения к пользователю
- Формат: одно предложение или фрагмент

**Применение:** Используется для режима `void`.

---

## Директория `/readme_resource/`

### `logo_name.jpeg`
**Назначение:** Логотип проекта для README.

**Применение:** Отображается в README.md через markdown:
```markdown
![logo](readme_resource/logo_name.jpeg)
```

---

## Рекомендуемые дополнения к структуре

### `/src/__init__.py`
Сделать `src` настоящим Python пакетом.

### `/src/ai/__init__.py`
```python
from .responder import respond
from .filters import filter_length, filter_advice, filter_empathy
from .silence import should_be_silent
```

### `/src/modules/__init__.py`
```python
from .ask import ask
from .distort import distort
from .void import void
from .silence import silence
```

### `/src/utils/__init__.py`
```python
from .randomness import random_prompt, random_prompt_block
from .delay import random_delay, typing_effect
from .text import fragment_sentence, extract_random_word
```

### `/tests/`
Директория для тестов:
- `test_filters.py` - тесты фильтров
- `test_randomness.py` - тесты рандомизации
- `test_responder.py` - тесты основной логики

### `/logs/`
Директория для логов взаимодействий (опционально).

### `/.env.example`
Шаблон файла окружения без реальных ключей.

---

## Порядок разработки

### Этап 1: Базовая инфраструктура
1. Создать `__init__.py` файлы во всех директориях
2. Реализовать `src/utils/delay.py`
3. Реализовать `src/utils/text.py`
4. Настроить `config.env` с переменными окружения

### Этап 2: Ядро ИИ
1. Реализовать `src/ai/silence.py` (логика молчания)
2. Реализовать `src/ai/responder.py` (интеграция с LLM API)
3. Протестировать цепочку: ввод → промпт → LLM → фильтры → вывод

### Этап 3: Режимы работы
1. Реализовать `src/modules/ask.py`
2. Реализовать `src/modules/distort.py`
3. Реализовать `src/modules/void.py`
4. Реализовать `src/modules/silence.py`

### Этап 4: Интеграция
1. Обновить `mailn.py` для работы с режимами
2. Добавить выбор режима через команды (например, `/distort`)
3. Добавить эффекты задержки и печати
4. Протестировать полный цикл

### Этап 5: Полировка
1. Добавить логирование
2. Обработка ошибок
3. Документация в коде
4. Тесты

---

## Примеры взаимодействия

### Режим Ask
```
> Я не понимаю, зачем я это делаю
[пауза 1.2 сек]
< А "это" - что именно?
```

### Режим Distort
```
> Сегодня был странный день, много мыслей
[пауза 0.8 сек]
< странный...
```

### Режим Void
```
[молчание 5 минут]
< Время не спешит.
[молчание продолжается]
```

### Режим Silence
```
> Привет
[молчание]
> Ты здесь?
[молчание]
```

---

## Технический стек

- **Python:** 3.8+
- **LLM API:** OpenAI / Anthropic / Local (Ollama)
- **Библиотеки:**
  - `rich` - форматирование терминала
  - `python-dotenv` - загрузка .env файлов
  - `openai` / `anthropic` - API клиенты
  - `pytest` - тестирование

---

## Философия кода

1. **Минимализм:** Код должен быть простым и понятным
2. **Модульность:** Каждый модуль отвечает за одну функцию
3. **Недосказанность:** Неполнота - это нормально (как в ответах ИИ)
4. **Тишина:** Отсутствие ответа - тоже ответ
5. **Случайность:** Рандомизация создает живость

---

## Заключение

Структура проекта отражает его философию: простота, модульность, пространство для паузы. Каждый файл выполняет свою роль в создании опыта "молчаливого философского пространства", где ИИ не помогает, а просто остается.